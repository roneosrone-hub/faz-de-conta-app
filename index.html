<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Faz de Conta Decora√ß√µes ‚Ä¢ Cat√°logo</title>

  <style>
    :root{
      --bg0:#070916;
      --bg1:#0b1230;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --muted2: rgba(255,255,255,.45);
      --shadow: 0 18px 50px rgba(0,0,0,.55);
      --radius: 22px;
      --radius2: 18px;
      --ok: rgba(0,255,213,.25);
      --pink: rgba(255,75,216,.35);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans";
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 15%, rgba(122, 66, 255,.25), transparent 60%),
        radial-gradient(900px 600px at 80% 30%, rgba(0, 255, 213,.14), transparent 55%),
        radial-gradient(900px 600px at 40% 90%, rgba(255, 64, 208,.12), transparent 50%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    .spark{
      position:fixed; inset:0; pointer-events:none; opacity:.55;
      background:
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.25), transparent 60%),
        radial-gradient(2px 2px at 35% 55%, rgba(255,255,255,.18), transparent 60%),
        radial-gradient(1px 1px at 70% 20%, rgba(255,255,255,.20), transparent 60%),
        radial-gradient(2px 2px at 85% 70%, rgba(255,255,255,.16), transparent 60%);
      filter: blur(.2px);
      mix-blend-mode: screen;
    }

    .wrap{
      width:min(1200px, 94vw);
      margin: 18px auto 52px;
    }

    /* ====== TOP BAR (SLOGAN FIXO) ====== */
    .floatingSlogan{
      position: sticky;
      top: 10px;
      z-index: 20;
      width: fit-content;
      margin: 0 0 12px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,.24);
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
      display:flex;
      align-items:center;
      gap:10px;
      backdrop-filter: blur(10px);
    }
    .floatingSlogan .txt{
      font-weight: 950;
      letter-spacing:.15px;
      font-size: 15px;
      color: rgba(255,255,255,.94);
      text-shadow: 0 10px 26px rgba(0,0,0,.45);
    }

    /* ====== HEADER ====== */
    .header{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
      padding: 16px;
    }
    .header::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(700px 200px at 20% 10%, rgba(255,255,255,.10), transparent 55%),
                  radial-gradient(600px 240px at 80% 0%, rgba(0,255,213,.12), transparent 55%);
      opacity:.65;
      pointer-events:none;
    }

    .headGrid{
      position:relative;
      z-index:1;
      display:grid;
      grid-template-columns: 1fr 240px;
      gap: 14px;
      align-items:start;
    }
    @media(max-width: 980px){
      .headGrid{ grid-template-columns: 1fr; }
    }

    .brandRow{
      display:flex;
      align-items:center;
      gap: 14px;
      flex-wrap:wrap;
      justify-content:center;
      padding: 6px 4px 10px;
    }

    .logoBox{
      width: 160px;
      height: 140px;
      border-radius: 18px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 14px 35px rgba(0,0,0,.35);
      overflow:hidden;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      flex: 0 0 auto;
    }
    .logoBox img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:none;
    }
    .logoFallback{
      font-weight: 1000;
      letter-spacing:.6px;
      color: rgba(255,255,255,.90);
      opacity:.9;
      display:flex;
      flex-direction:column;
      gap: 6px;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 10px;
    }
    .logoFallback small{ opacity:.75; font-weight: 800; }

    .titleStack{ min-width: 240px; text-align:center; }

    .gradTitle{
      font-weight: 1000;
      font-size: 46px;
      line-height: 1.05;
      letter-spacing: .7px;
      text-transform: uppercase;
      background: linear-gradient(
        90deg,
        #ff4bd8 0%,
        #7a42ff 18%,
        #00c7ff 34%,
        #00ffd5 50%,
        #7dff6a 66%,
        #ffd94a 82%,
        #ff4bd8 100%
      );
      background-size: 260% 100%;
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
      animation: gradMove 6.5s linear infinite;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,.55));
      margin: 0;
    }
    @keyframes gradMove{
      0%{ background-position:0% 50%; }
      100%{ background-position:260% 50%; }
    }

    .sloganBelow{
      margin-top: 8px;
      font-size: 17px;
      font-weight: 950;
      color: rgba(255,255,255,.94);
      letter-spacing:.2px;
      text-shadow: 0 10px 26px rgba(0,0,0,.45);
    }

    /* META VERTICAL (direita) */
    .metaCol{
      display:flex;
      flex-direction:column;
      gap: 10px;
      align-items:stretch;
      justify-content:flex-start;
    }
    .chip{
      display:flex;
      gap:10px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.80);
      font-size: 12.8px;
      box-shadow: 0 10px 26px rgba(0,0,0,.25);
      white-space:nowrap;
    }
    .chip b{ color: rgba(255,255,255,.92); }

    /* BOT√ïES */
    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-start;
      margin-top: 12px;
      position:relative;
      z-index:1;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      border:none;
      cursor:pointer;
      color: rgba(255,255,255,.92);
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 850;
      font-size: 13px;
      box-shadow: 0 14px 35px rgba(0,0,0,.28);
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.11); border-color: rgba(255,255,255,.18); }
    .btn:active{ transform: translateY(0px) scale(.99); }
    .btn.primary{
      background: linear-gradient(90deg, rgba(255,75,216,.38), rgba(0,255,213,.26), rgba(255,217,74,.24));
      border-color: rgba(255,255,255,.18);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 28px;
      height: 22px;
      padding: 0 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.14);
      font-weight: 1000;
      font-size: 12px;
      margin-left: 6px;
    }

    /* ====== MAIN (MONTAGEM + CONTROLES) ====== */
    .main{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap: 14px;
      align-items:stretch;
    }
    @media(max-width: 980px){
      .main{ grid-template-columns: 1fr; }
    }

    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }

    /* QUADRO DA MONTAGEM */
    .stageHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
    }
    .stageHead .title{
      font-weight: 1000;
      letter-spacing:.2px;
    }
    .stageHead .miniHint{
      font-size: 12px;
      color: rgba(255,255,255,.65);
    }

    .stage{
      position:relative;
      height: 440px;
      background:
        radial-gradient(900px 500px at 20% 15%, rgba(255,255,255,.06), transparent 60%),
        radial-gradient(700px 450px at 80% 35%, rgba(0,255,213,.08), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.28));
      overflow:hidden;
    }
    @media(max-width: 560px){
      .stage{ height: 380px; }
    }

    /* ‚Äúfundo‚Äù bonitinho (opcional) */
    .stageBackdrop{
      position:absolute;
      inset: 14px;
      border-radius: 18px;
      border:1px dashed rgba(255,255,255,.18);
      background:
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      pointer-events:none;
    }

    .stageGrid{
      position:absolute;
      inset: 14px;
      border-radius: 18px;
      background:
        linear-gradient(rgba(255,255,255,.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.06) 1px, transparent 1px);
      background-size: 32px 32px;
      opacity:.16;
      pointer-events:none;
      mix-blend-mode: screen;
    }

    /* sticker (recorte) */
    .sticker{
      position:absolute;
      left: 80px;
      top: 80px;
      width: 180px;
      height: 180px;
      transform: translate3d(0,0,0);
      user-select:none;
      touch-action:none;
      cursor: grab;
      border-radius: 16px;
      outline: 1px solid rgba(255,255,255,.00);
    }
    .sticker:active{ cursor: grabbing; }
    .sticker.selected{
      outline: 1px solid rgba(0,255,213,.45);
      box-shadow: 0 0 0 6px rgba(0,255,213,.10), 0 18px 60px rgba(0,0,0,.55);
    }
    .sticker img{
      width:100%;
      height:100%;
      object-fit: contain;
      display:block;
      pointer-events:none;
      filter: drop-shadow(0 14px 30px rgba(0,0,0,.55));
    }

    /* al√ßas de resize */
    .handle{
      position:absolute;
      width: 14px;
      height: 14px;
      border-radius: 8px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.35);
      box-shadow: 0 10px 24px rgba(0,0,0,.45);
      display:none;
    }
    .sticker.selected .handle{ display:block; }
    .h-br{ right: -7px; bottom: -7px; cursor: nwse-resize; }
    .h-tr{ right: -7px; top: -7px; cursor: nesw-resize; }
    .h-bl{ left: -7px; bottom: -7px; cursor: nesw-resize; }
    .h-tl{ left: -7px; top: -7px; cursor: nwse-resize; }

    /* barra inferior do quadro */
    .stageBar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      padding: 12px 14px;
      border-top: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
    }
    .stageBar .left{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .badgeSmall{
      font-size: 12px;
      color: rgba(255,255,255,.70);
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
    }

    /* PAINEL CONTROLE (lado direito) */
    .panel{
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .panelTitle{
      font-weight: 1000;
      letter-spacing:.2px;
      font-size: 16px;
      margin: 0;
    }
    .panelText{
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height:1.4;
    }

    .field{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
    }
    .field input, .field select, .field textarea{
      width:100%;
      border:none;
      outline:none;
      background: transparent;
      color: rgba(255,255,255,.9);
      font-size: 13px;
      font-family: inherit;
      resize:none;
    }
    .field textarea{ min-height: 64px; }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }

    .toggle{
      display:flex;
      align-items:center;
      gap:10px;
      color: rgba(255,255,255,.75);
      font-size: 13px;
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 10px 12px;
      user-select:none;
    }
    .switch{
      width: 44px; height: 26px;
      border-radius: 999px;
      background: rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.14);
      position:relative;
      cursor:pointer;
      flex:0 0 auto;
    }
    .knob{
      width: 22px; height: 22px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      position:absolute;
      top:1px; left:1px;
      transition: left .18s ease, background .18s ease;
    }
    .switch.on{ background: rgba(0,255,213,.24); }
    .switch.on .knob{ left: 21px; background: rgba(255,255,255,.96); }

    .verseBox{
      padding: 14px 14px;
      border-radius: 16px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.86);
    }
    .verseTitle{
      font-weight: 1000;
      margin-bottom: 8px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .verseText{
      color: rgba(255,255,255,.78);
      line-height: 1.45;
      font-size: 13px;
      margin:0;
    }
    .verseRef{
      margin-top: 8px;
      font-weight: 900;
      color: rgba(255,255,255,.9);
      font-size: 12px;
      opacity:.92;
    }

    /* CONTROLES DO ITEM SELECIONADO */
    .controlGroup{
      padding: 12px;
      border-radius: 16px;
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.12);
    }
    .controlGroup .label{
      font-size: 12px;
      color: rgba(255,255,255,.72);
      margin-bottom: 8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .controlGroup .label b{ color: rgba(255,255,255,.92); }
    .slider{
      width:100%;
    }
    .miniBtns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .btnMini{
      padding: 9px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 900;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.92);
      cursor:pointer;
    }
    .btnMini:hover{ background: rgba(255,255,255,.11); }
    .btnMini.danger{
      background: rgba(255,64,208,.12);
      border-color: rgba(255,64,208,.22);
    }

    /* ====== CATALOGO GRID ====== */
    .sectionTitle{
      margin: 18px 0 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .sectionTitle h3{
      margin:0;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .badge{
      font-size: 12px;
      color: rgba(255,255,255,.65);
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    @media(max-width: 980px){ .grid{ grid-template-columns: repeat(2, 1fr);} }
    @media(max-width: 560px){ .grid{ grid-template-columns: 1fr;} }

    .itemCard{
      padding: 12px;
      cursor:pointer;
    }
    .thumb{
      height: 150px;
      border-radius: 18px;
      overflow:hidden;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      transform: scale(1.02);
      transition: transform .25s ease;
    }
    .itemCard:hover .thumb img{ transform: scale(1.06); }

    .itemName{
      margin: 10px 0 6px;
      font-weight: 1000;
      letter-spacing:.2px;
    }
    .itemDesc{
      margin:0;
      color: rgba(255,255,255,.65);
      font-size: 12px;
      line-height:1.35;
      min-height: 32px;
    }
    .itemFooter{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
    }
    .price{
      font-weight: 1000;
      font-size: 13px;
      color: rgba(255,255,255,.88);
    }
    .tag{
      font-size: 12px;
      color: rgba(255,255,255,.65);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
    }

    .footer{
      margin-top: 18px;
      text-align:center;
      color: rgba(255,255,255,.45);
      font-size: 12px;
    }

    /* ====== MODAL ITEM ====== */
    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.6);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 999;
    }
    .modal{
      width: min(980px, 96vw);
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 25px 90px rgba(0,0,0,.7);
      overflow:hidden;
      backdrop-filter: blur(12px);
    }
    .modalHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 12px 14px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .modalHead strong{ font-size: 14px; }
    .x{
      border:none;
      width: 40px; height: 40px;
      border-radius: 14px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.88);
      font-weight: 1000;
      cursor:pointer;
    }
    .modalBody{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 12px;
      padding: 12px;
    }
    @media(max-width: 900px){ .modalBody{ grid-template-columns: 1fr; } }

    .viewer{
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      min-height: 300px;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .viewer img{
      width:100%;
      height:100%;
      object-fit: contain;
      display:block;
      padding: 12px;
      filter: drop-shadow(0 14px 30px rgba(0,0,0,.55));
    }

    .side{
      padding: 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      height: 100%;
    }
    .line{
      color: rgba(255,255,255,.70);
      font-size: 13px;
      margin-bottom: 10px;
      line-height:1.35;
    }
    .line b{ color: rgba(255,255,255,.92); }

    .ctaRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    @media(max-width: 560px){
      .gradTitle{ font-size: 34px; }
      .sloganBelow{ font-size: 15px; }
      .logoBox{ width: 120px; height: 110px; }
      .floatingSlogan .txt{ font-size: 14px; }
    }
  </style>
</head>

<body>
  <div class="spark"></div>

  <div class="wrap">
    <div class="floatingSlogan">
      <span>‚ú®</span>
      <div class="txt">Onde a imagina√ß√£o vira festa</div>
    </div>

    <div class="header">
      <div class="headGrid">
        <div>
          <div class="brandRow">
            <div class="logoBox" id="logoBox" title="Logo">
              <img id="logoImg" alt="Logo Faz de Conta"/>
              <div class="logoFallback" id="logoFallback">
                <div style="font-size:28px;">FC</div>
                <small>Envie logo.png ou logo.jpg</small>
              </div>
            </div>

            <div class="titleStack">
              <h1 class="gradTitle">FAZ DE CONTA DECORA√á√ïES</h1>
              <div class="sloganBelow">‚ú® Onde a imagina√ß√£o vira festa</div>
            </div>
          </div>

          <div class="actions">
            <button class="btn" id="btnWhats">üí¨ WhatsApp</button>
            <button class="btn" id="btnCart">üõí Selecionados <span class="pill" id="cartCount">0</span></button>
            <button class="btn" id="btnClearStage">üßº Limpar montagem</button>
            <button class="btn primary" id="btnFinish">‚úÖ Finalizar</button>
          </div>
        </div>

        <div class="metaCol">
          <div class="chip">üìç <b id="cityChip">Jaciara/MT</b></div>
          <div class="chip">üí¨ <b>WhatsApp:</b> <span id="whatsChip">(66) 99622-3481</span></div>
          <div class="chip">üìÖ <span id="today">--/--/----</span> ‚Ä¢ ‚è∞ <b id="clock">--:--</b></div>
        </div>
      </div>
    </div>

    <div class="main">
      <!-- QUADRO (montagem) -->
      <div class="card">
        <div class="stageHead">
          <div>
            <div class="title">üß© Montagem do cliente</div>
            <div class="miniHint">Clique em um item do cat√°logo e ‚ÄúAdicionar na montagem‚Äù. Arraste, redimensione e mude a cor.</div>
          </div>
          <div class="badgeSmall" id="stageHint">Dica: selecione um item na montagem para editar.</div>
        </div>

        <div class="stage" id="stage">
          <div class="stageBackdrop"></div>
          <div class="stageGrid"></div>
        </div>

        <div class="stageBar">
          <div class="left">
            <span class="badgeSmall">Selecionado: <b id="selectedName">nenhum</b></span>
            <span class="badgeSmall">Camadas: <b id="layerInfo">‚Äî</b></span>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btnMini" id="btnExport">üì∏ Exportar imagem</button>
            <button class="btnMini" id="btnDeselect">‚úã Desmarcar</button>
          </div>
        </div>
      </div>

      <!-- PAINEL (filtros + controles) -->
      <div class="card panel">
        <div>
          <h3 class="panelTitle">üß† Assistente de montagem</h3>
          <p class="panelText">Aqui voc√™ controla o item selecionado e monta uma pr√©via r√°pida para o cliente.</p>
        </div>

        <div class="field">
          üîé <input id="q" placeholder="Pesquisar (ex: arco, bal√µes, tapete...)"/>
        </div>

        <div class="field">
          üß©
          <select id="cat">
            <option value="Todas">Todas as categorias</option>
          </select>
        </div>

        <div class="row">
          <div class="toggle">
            üîí Mostrar pre√ßos
            <div class="switch" id="priceSwitch"><div class="knob"></div></div>
          </div>
          <button class="btn" id="btnClear">üßº Limpar filtro</button>
        </div>

        <div class="verseBox" id="verseBox">
          <div class="verseTitle">üìñ Vers√≠culo b√≠blico do dia</div>
          <p class="verseText" id="verseText">Carregando‚Ä¶</p>
          <div class="verseRef" id="verseRef"></div>
        </div>

        <div class="controlGroup">
          <div class="label">
            <span>üéØ Item selecionado</span>
            <b id="ctrlStatus">Nenhum</b>
          </div>

          <div class="label"><span>Cor (tint)</span><b id="colorRead">‚Äî</b></div>
          <input type="color" id="ctrlColor" value="#ffffff" style="width:100%; height:44px; border-radius:12px; border:1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.18);">

          <div style="height:10px"></div>

          <div class="label"><span>Opacidade</span><b id="opacityRead">100%</b></div>
          <input class="slider" type="range" id="ctrlOpacity" min="10" max="100" value="100">

          <div style="height:10px"></div>

          <div class="label"><span>Rota√ß√£o</span><b id="rotateRead">0¬∞</b></div>
          <input class="slider" type="range" id="ctrlRotate" min="-180" max="180" value="0">

          <div style="height:10px"></div>

          <div class="label"><span>Tamanho</span><b id="sizeRead">100%</b></div>
          <input class="slider" type="range" id="ctrlSize" min="40" max="220" value="100">

          <div class="miniBtns">
            <button class="btnMini" id="btnFront">‚¨ÜÔ∏è Frente</button>
            <button class="btnMini" id="btnBack">‚¨áÔ∏è Tr√°s</button>
            <button class="btnMini danger" id="btnDelete">üóëÔ∏è Remover</button>
          </div>
        </div>

        <div class="controlGroup">
          <div class="label"><span>üí° Observa√ß√£o</span><b>Pro</b></div>
          <div style="font-size:12px;color:rgba(255,255,255,.65);line-height:1.45;">
            Para ficar ‚Äúminiatura real‚Äù na montagem, suba recortes em PNG com fundo transparente (ex: <b>baloes.png</b>, <b>arco.png</b>).
            Se tiver fundo preto, a montagem sempre vai parecer ‚Äúfoto‚Äù. PNG transparente resolve.
          </div>
        </div>
      </div>
    </div>

    <div class="sectionTitle">
      <h3>‚ú® Itens do cat√°logo</h3>
      <div class="badge"><span id="itemsCount">0</span> itens</div>
    </div>

    <div class="grid" id="grid"></div>

    <div class="footer">¬© Faz de Conta Decora√ß√µes ‚Ä¢ Cat√°logo</div>
  </div>

  <!-- MODAL ITEM -->
  <div class="modalBack" id="modalItemBack">
    <div class="modal">
      <div class="modalHead">
        <strong id="modalTitle">Item</strong>
        <button class="x" id="closeItem">‚úï</button>
      </div>

      <div class="modalBody">
        <div class="viewer">
          <img id="modalImg" alt="Pr√©via do item"/>
        </div>

        <div class="side">
          <div class="line"><b>Descri√ß√£o:</b> <span id="modalDesc"></span></div>
          <div class="line"><b>Categoria:</b> <span id="modalCat"></span></div>
          <div class="line"><b>Pre√ßo:</b> <span id="modalPrice"></span></div>
          <div class="line" style="opacity:.85"><b>Miniatura (montagem):</b> <span id="modalCutoutName">‚Äî</span></div>

          <div class="ctaRow">
            <button class="btn primary" id="btnAddToStage">‚ûï Adicionar na montagem</button>
            <button class="btn" id="btnAddCart">üõí Selecionar</button>
          </div>

          <div class="verseBox" style="margin-top:12px;">
            <div class="verseTitle">üìå Nome dos arquivos</div>
            <p class="verseText" style="margin:0;">
              Suba na raiz do projeto: <b>logo.png</b> (ou <b>logo.jpg</b>) e as imagens dos itens. Para miniaturas na montagem, use PNG transparente (ex: <b>arco.png</b>, <b>baloes.png</b>).
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ===================== CONFIG =====================
  const CONFIG = {
    whatsappNumber: "5566996223481",
    whatsappDisplay: "(66) 99622-3481",
    cidade: "Jaciara/MT"
  };

  // ===================== ITENS (edite aqui) =====================
  // photo: foto normal do cat√°logo (pode ser jpg)
  // cutout: recorte/miniatura para a montagem (ideal: PNG transparente)
  const ITENS = [
    {
      id:"baloes",
      nome:"Bal√µes (arranjo)",
      cat:"Bal√µes",
      desc:"Bal√µes para composi√ß√£o (use recorte em PNG para montagem ficar real).",
      preco: 0,
      photo: "baloes-foto.jpg",
      cutout: "baloes.png"
    },
    {
      id:"arco",
      nome:"Arco de bal√µes",
      cat:"Bal√µes",
      desc:"Arco org√¢nico e tem√°tico (montagem sob consulta).",
      preco: 0,
      photo: "arco-foto.jpg",
      cutout: "arco.png"
    },
    {
      id:"cortina",
      nome:"Cortina de LED",
      cat:"Ilumina√ß√£o",
      desc:"Fundo e acabamento com luz.",
      preco: 0,
      photo: "cortina-foto.jpg",
      cutout: "cortina-led.png"
    },
    {
      id:"tapete",
      nome:"Tapete para fotos",
      cat:"Cen√°rio",
      desc:"Base para fotos e cen√°rio.",
      preco: 0,
      photo: "tapete-foto.jpg",
      cutout: "tapete.png"
    },
    {
      id:"cilindros",
      nome:"Cilindros (suporte)",
      cat:"Estruturas",
      desc:"Estruturas e suporte para decora√ß√£o.",
      preco: 0,
      photo: "cilindros-foto.jpg",
      cutout: "cilindros.png"
    }
  ];

  // ===================== UTIL =====================
  const el = (id)=>document.getElementById(id);
  const money = (v)=> "R$ " + Number(v||0).toFixed(2).replace(".",",");

  // ===================== DATA / REL√ìGIO =====================
  el("cityChip").textContent = CONFIG.cidade;
  el("whatsChip").textContent = CONFIG.whatsappDisplay;

  function tick(){
    const d = new Date();
    const dd = String(d.getDate()).padStart(2,"0");
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const yy = d.getFullYear();
    el("today").textContent = `${dd}/${mm}/${yy}`;
    el("clock").textContent = d.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
  }
  tick(); setInterval(tick, 1000);

  // ===================== LOGO (logo.png/jpg/jpeg/webp) =====================
  function loadLogo(){
    const img = el("logoImg");
    const fb = el("logoFallback");
    const candidates = ["logo.png","logo.jpg","logo.jpeg","logo.webp"];
    let i = 0;

    function tryNext(){
      if(i >= candidates.length){
        img.style.display = "none";
        fb.style.display = "flex";
        return;
      }
      img.src = candidates[i++];
    }

    img.onload = ()=>{
      img.style.display = "block";
      fb.style.display = "none";
    };
    img.onerror = tryNext;
    tryNext();
  }
  loadLogo();

  // ===================== FILTROS / PRE√áOS =====================
  let showPrices = false;
  const state = {
    q: "",
    cat: "Todas",
    cart: new Map()
  };

  function setSwitch(on){
    const sw = el("priceSwitch");
    sw.classList.toggle("on", on);
    showPrices = on;
    render();
  }
  el("priceSwitch").addEventListener("click", ()=> setSwitch(!showPrices));

  el("q").addEventListener("input",(e)=>{
    state.q = (e.target.value||"").toLowerCase().trim();
    render();
  });
  el("cat").addEventListener("change",(e)=>{
    state.cat = e.target.value;
    render();
  });
  el("btnClear").addEventListener("click", ()=>{
    state.q = "";
    state.cat = "Todas";
    el("q").value = "";
    el("cat").value = "Todas";
    render();
  });

  function buildCats(){
    const s = new Set(ITENS.map(i=>i.cat));
    const sel = el("cat");
    [...s].sort().forEach(c=>{
      const opt = document.createElement("option");
      opt.value = c; opt.textContent = c;
      sel.appendChild(opt);
    });
  }
  buildCats();

  function passFilter(item){
    const okCat = (state.cat === "Todas") || (item.cat === state.cat);
    const t = (item.nome + " " + item.desc + " " + item.cat).toLowerCase();
    const okQ = !state.q || t.includes(state.q);
    return okCat && okQ;
  }

  // ===================== GRID (CAT√ÅLOGO) =====================
  let currentItem = null;

  function render(){
    const list = ITENS.filter(passFilter);
    el("itemsCount").textContent = list.length;

    const grid = el("grid");
    grid.innerHTML = "";

    list.forEach(item=>{
      const card = document.createElement("div");
      card.className = "card itemCard";

      const thumb = document.createElement("div");
      thumb.className = "thumb";

      const img = document.createElement("img");
      img.alt = item.nome;

      // tenta photo, se falhar tenta cutout, se falhar capa
      const candidates = [item.photo, item.cutout, "capa.jpg", "capa.png"].filter(Boolean);
      let i = 0;
      function tryNext(){
        if(i >= candidates.length) return;
        img.src = candidates[i++];
      }
      img.onload = ()=>{};
      img.onerror = tryNext;
      tryNext();

      thumb.appendChild(img);

      const name = document.createElement("div");
      name.className = "itemName";
      name.textContent = item.nome;

      const desc = document.createElement("p");
      desc.className = "itemDesc";
      desc.textContent = item.desc;

      const footer = document.createElement("div");
      footer.className = "itemFooter";

      const price = document.createElement("div");
      price.className = "price";
      price.textContent = showPrices ? money(item.preco) : "Pre√ßo: sob consulta";

      const tag = document.createElement("div");
      tag.className = "tag";
      tag.textContent = item.cat;

      footer.appendChild(tag);
      footer.appendChild(price);

      card.appendChild(thumb);
      card.appendChild(name);
      card.appendChild(desc);
      card.appendChild(footer);

      card.addEventListener("click", ()=> openItem(item.id));
      grid.appendChild(card);
    });

    el("cartCount").textContent = [...state.cart.values()].reduce((a,b)=>a+b,0);
  }
  render();

  // ===================== MODAL =====================
  function openItem(id){
    currentItem = ITENS.find(x=>x.id===id);
    if(!currentItem) return;

    el("modalTitle").textContent = currentItem.nome;
    el("modalDesc").textContent = currentItem.desc;
    el("modalCat").textContent = currentItem.cat;
    el("modalPrice").textContent = showPrices ? money(currentItem.preco) : "Sob consulta";
    el("modalCutoutName").textContent = currentItem.cutout || "‚Äî";

    const img = el("modalImg");
    const candidates = [currentItem.photo, currentItem.cutout, "capa.jpg", "capa.png"].filter(Boolean);
    let i = 0;
    function tryNext(){
      if(i >= candidates.length) return;
      img.src = candidates[i++];
    }
    img.onerror = tryNext;
    tryNext();

    el("modalItemBack").style.display = "flex";
  }
  function closeItem(){
    el("modalItemBack").style.display = "none";
    currentItem = null;
  }
  el("closeItem").addEventListener("click", closeItem);
  el("modalItemBack").addEventListener("click",(e)=>{
    if(e.target === el("modalItemBack")) closeItem();
  });

  // ===================== MONTAGEM (STAGE) =====================
  const stage = el("stage");
  let selectedSticker = null;
  let zCounter = 10;

  function deselect(){
    if(selectedSticker){
      selectedSticker.classList.remove("selected");
      selectedSticker = null;
    }
    updateControls();
  }
  stage.addEventListener("pointerdown",(e)=>{
    // clique no fundo: desmarcar
    if(e.target === stage) deselect();
  });

  function selectSticker(node){
    if(selectedSticker && selectedSticker !== node){
      selectedSticker.classList.remove("selected");
    }
    selectedSticker = node;
    selectedSticker.classList.add("selected");
    selectedSticker.style.zIndex = ++zCounter;
    updateControls();
  }

  function applyStickerVisual(node){
    // usa CSS variables guardadas no dataset
    const tint = node.dataset.tint || "#ffffff";
    const opacity = Number(node.dataset.opacity || 100);
    const rotate = Number(node.dataset.rotate || 0);
    const scalePct = Number(node.dataset.scale || 100);

    // filtro de tint simples: mistura via brightness/saturate + hue-rotate aproximado
    // (para ‚Äúcolorir‚Äù bal√µes melhor, o ideal √© recorte j√° neutro; aqui √© um efeito visual)
    // vamos aplicar um overlay com mix-blend-mode via pseudo? (mais complexo). Aqui: hue-rotate aproximado.
    const hue = hexToHue(tint);
    const sat = 1.15;
    const bright = 1.05;

    node.style.opacity = (opacity/100).toFixed(2);
    node.style.transform = `rotate(${rotate}deg) scale(${(scalePct/100).toFixed(3)})`;
    const img = node.querySelector("img");
    if(img){
      img.style.filter = `drop-shadow(0 14px 30px rgba(0,0,0,.55)) hue-rotate(${hue}deg) saturate(${sat}) brightness(${bright})`;
    }
  }

  function addStickerFromItem(item){
    const node = document.createElement("div");
    node.className = "sticker";
    node.dataset.itemId = item.id;
    node.dataset.name = item.nome;

    // estado visual
    node.dataset.tint = "#ffffff";
    node.dataset.opacity = "100";
    node.dataset.rotate = "0";
    node.dataset.scale = "100";
    node.style.left = "90px";
    node.style.top = "90px";
    node.style.zIndex = ++zCounter;

    // imagem
    const img = document.createElement("img");
    img.alt = item.nome;

    const candidates = [item.cutout, item.photo, "capa.png", "capa.jpg"].filter(Boolean);
    let i = 0;
    function tryNext(){
      if(i >= candidates.length) return;
      img.src = candidates[i++];
    }
    img.onerror = tryNext;
    tryNext();

    node.appendChild(img);

    // handles
    const hTL = document.createElement("div"); hTL.className="handle h-tl"; node.appendChild(hTL);
    const hTR = document.createElement("div"); hTR.className="handle h-tr"; node.appendChild(hTR);
    const hBL = document.createElement("div"); hBL.className="handle h-bl"; node.appendChild(hBL);
    const hBR = document.createElement("div"); hBR.className="handle h-br"; node.appendChild(hBR);

    // eventos
    node.addEventListener("pointerdown",(e)=>{
      e.stopPropagation();
      selectSticker(node);
    });

    makeDraggable(node);
    makeResizable(node);

    stage.appendChild(node);
    selectSticker(node);
    updateLayerInfo();
  }

  // Drag
  function makeDraggable(node){
    let dragging = false;
    let startX=0, startY=0, startL=0, startT=0;

    node.addEventListener("pointerdown",(e)=>{
      // se clicou em handle, n√£o arrasta
      if(e.target.classList.contains("handle")) return;

      dragging = true;
      node.setPointerCapture(e.pointerId);

      const rect = node.getBoundingClientRect();
      startX = e.clientX;
      startY = e.clientY;
      startL = rect.left;
      startT = rect.top;

      node.style.cursor = "grabbing";
      e.preventDefault();
    });

    node.addEventListener("pointermove",(e)=>{
      if(!dragging) return;
      const stageRect = stage.getBoundingClientRect();

      const dx = e.clientX - startX;
      const dy = e.clientY - startY;

      // posi√ß√£o relativa ao stage
      const newLeft = (startL - stageRect.left) + dx;
      const newTop  = (startT - stageRect.top) + dy;

      node.style.left = clamp(newLeft, -40, stageRect.width - 40) + "px";
      node.style.top  = clamp(newTop,  -40, stageRect.height - 40) + "px";
    });

    node.addEventListener("pointerup",(e)=>{
      dragging = false;
      node.style.cursor = "grab";
      try{ node.releasePointerCapture(e.pointerId); }catch(_){}
    });
  }

  // Resize (mant√©m propor√ß√£o)
  function makeResizable(node){
    const handles = node.querySelectorAll(".handle");
    handles.forEach(h=>{
      h.addEventListener("pointerdown",(e)=>{
        e.stopPropagation();
        selectSticker(node);

        const startW = node.offsetWidth;
        const startH = node.offsetHeight;
        const startX = e.clientX;
        const startY = e.clientY;

        node.setPointerCapture(e.pointerId);

        const onMove = (ev)=>{
          const dx = ev.clientX - startX;
          const dy = ev.clientY - startY;
          const delta = Math.max(dx, dy);
          const newW = clamp(startW + delta, 70, 520);
          const ratio = startH / startW;
          node.style.width = newW + "px";
          node.style.height = Math.round(newW * ratio) + "px";
        };

        const onUp = (ev)=>{
          node.removeEventListener("pointermove", onMove);
          node.removeEventListener("pointerup", onUp);
          try{ node.releasePointerCapture(ev.pointerId); }catch(_){}
          updateControls(); // reflete em sliders
        };

        node.addEventListener("pointermove", onMove);
        node.addEventListener("pointerup", onUp);
      });
    });
  }

  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

  // ===================== CONTROLES (painel) =====================
  const ctrlStatus = el("ctrlStatus");
  const selectedName = el("selectedName");
  const layerInfo = el("layerInfo");

  const ctrlColor = el("ctrlColor");
  const ctrlOpacity = el("ctrlOpacity");
  const ctrlRotate = el("ctrlRotate");
  const ctrlSize = el("ctrlSize");

  const colorRead = el("colorRead");
  const opacityRead = el("opacityRead");
  const rotateRead = el("rotateRead");
  const sizeRead = el("sizeRead");

  function updateLayerInfo(){
    const stickers = [...stage.querySelectorAll(".sticker")];
    layerInfo.textContent = `${stickers.length} item(ns)`;
  }

  function updateControls(){
    if(!selectedSticker){
      ctrlStatus.textContent = "Nenhum";
      selectedName.textContent = "nenhum";
      colorRead.textContent = "‚Äî";
      opacityRead.textContent = "100%";
      rotateRead.textContent = "0¬∞";
      sizeRead.textContent = "100%";
      return;
    }

    const name = selectedSticker.dataset.name || "Item";
    ctrlStatus.textContent = "Ativo";
    selectedName.textContent = name;

    const tint = selectedSticker.dataset.tint || "#ffffff";
    const opacity = Number(selectedSticker.dataset.opacity || 100);
    const rotate = Number(selectedSticker.dataset.rotate || 0);
    const scalePct = Number(selectedSticker.dataset.scale || 100);

    ctrlColor.value = tint;
    ctrlOpacity.value = String(opacity);
    ctrlRotate.value = String(rotate);
    ctrlSize.value = String(scalePct);

    colorRead.textContent = tint.toUpperCase();
    opacityRead.textContent = opacity + "%";
    rotateRead.textContent = rotate + "¬∞";
    sizeRead.textContent = scalePct + "%";
  }

  ctrlColor.addEventListener("input", ()=>{
    if(!selectedSticker) return;
    selectedSticker.dataset.tint = ctrlColor.value;
    applyStickerVisual(selectedSticker);
    updateControls();
  });

  ctrlOpacity.addEventListener("input", ()=>{
    if(!selectedSticker) return;
    selectedSticker.dataset.opacity = ctrlOpacity.value;
    applyStickerVisual(selectedSticker);
    updateControls();
  });

  ctrlRotate.addEventListener("input", ()=>{
    if(!selectedSticker) return;
    selectedSticker.dataset.rotate = ctrlRotate.value;
    applyStickerVisual(selectedSticker);
    updateControls();
  });

  ctrlSize.addEventListener("input", ()=>{
    if(!selectedSticker) return;
    selectedSticker.dataset.scale = ctrlSize.value;
    applyStickerVisual(selectedSticker);
    updateControls();
  });

  el("btnFront").addEventListener("click", ()=>{
    if(!selectedSticker) return;
    selectedSticker.style.zIndex = ++zCounter;
  });

  el("btnBack").addEventListener("click", ()=>{
    if(!selectedSticker) return;
    selectedSticker.style.zIndex = 1;
  });

  el("btnDelete").addEventListener("click", ()=>{
    if(!selectedSticker) return;
    selectedSticker.remove();
    selectedSticker = null;
    updateLayerInfo();
    updateControls();
  });

  el("btnDeselect").addEventListener("click", deselect);

  // ===================== BOT√ïES TOP =====================
  el("btnWhats").addEventListener("click", ()=>{
    const url = `https://wa.me/${CONFIG.whatsappNumber}?text=${encodeURIComponent("Ol√°! Quero informa√ß√µes sobre os itens do cat√°logo da Faz de Conta Decora√ß√µes.")}`;
    window.open(url, "_blank");
  });

  el("btnCart").addEventListener("click", ()=>{
    const total = [...state.cart.values()].reduce((a,b)=>a+b,0);
    const ids = [...state.cart.entries()].map(([k,v])=>{
      const it = ITENS.find(x=>x.id===k);
      return `‚Ä¢ ${it ? it.nome : k} x${v}`;
    }).join("\n");
    alert(`Selecionados: ${total} item(ns)\n\n${ids || "(vazio)"}`);
  });

  el("btnClearStage").addEventListener("click", ()=>{
    [...stage.querySelectorAll(".sticker")].forEach(n=>n.remove());
    deselect();
    updateLayerInfo();
  });

  el("btnFinish").addEventListener("click", ()=>{
    const total = [...state.cart.values()].reduce((a,b)=>a+b,0);
    const stageCount = stage.querySelectorAll(".sticker").length;
    alert(`Perfeito ‚úÖ\n\nSelecionados no cat√°logo: ${total}\nItens na montagem: ${stageCount}\n\n(Pr√≥ximo passo: gerar or√ßamento + mensagem autom√°tica pro WhatsApp.)`);
  });

  // ===================== MODAL CTA =====================
  el("btnAddCart").addEventListener("click", ()=>{
    if(!currentItem) return;
    const n = state.cart.get(currentItem.id) || 0;
    state.cart.set(currentItem.id, n+1);
    render();
    alert("Item selecionado ‚úÖ");
  });

  el("btnAddToStage").addEventListener("click", ()=>{
    if(!currentItem) return;
    addStickerFromItem(currentItem);
    closeItem();
  });

  // ===================== EXPORTAR ‚ÄúFOTO‚Äù DA MONTAGEM =====================
  el("btnExport").addEventListener("click", async ()=>{
    // export simples via html2canvas (sem lib externa): fazemos um print b√°sico com canvas manual
    // pega tamanho do stage e desenha as imagens na ordem de zIndex
    const rect = stage.getBoundingClientRect();
    const w = Math.round(rect.width);
    const h = Math.round(rect.height);

    const canvas = document.createElement("canvas");
    const dpr = window.devicePixelRatio || 1;
    canvas.width = Math.round(w * dpr);
    canvas.height = Math.round(h * dpr);
    const ctx = canvas.getContext("2d");
    ctx.setTransform(dpr,0,0,dpr,0,0);

    // fundo leve
    const grd = ctx.createLinearGradient(0,0,0,h);
    grd.addColorStop(0, "rgba(0,0,0,.20)");
    grd.addColorStop(1, "rgba(0,0,0,.32)");
    ctx.fillStyle = grd;
    ctx.fillRect(0,0,w,h);

    const nodes = [...stage.querySelectorAll(".sticker")].sort((a,b)=>{
      const za = Number(a.style.zIndex||0);
      const zb = Number(b.style.zIndex||0);
      return za - zb;
    });

    for(const n of nodes){
      const img = n.querySelector("img");
      if(!img || !img.src) continue;

      const x = parseFloat(n.style.left||"0");
      const y = parseFloat(n.style.top||"0");
      const bw = n.offsetWidth;
      const bh = n.offsetHeight;

      const scalePct = Number(n.dataset.scale || 100)/100;
      const rotate = Number(n.dataset.rotate || 0) * Math.PI/180;
      const opacity = Number(n.dataset.opacity || 100)/100;

      // carrega imagem
      const bitmap = await loadImage(img.src).catch(()=>null);
      if(!bitmap) continue;

      ctx.save();
      ctx.globalAlpha = opacity;

      // desenha com rota√ß√£o no centro do sticker
      const cx = x + bw/2;
      const cy = y + bh/2;

      ctx.translate(cx, cy);
      ctx.rotate(rotate);
      ctx.scale(scalePct, scalePct);

      // desenha contain
      const iw = bitmap.width, ih = bitmap.height;
      const scale = Math.min(bw/iw, bh/ih);
      const dw = iw * scale;
      const dh = ih * scale;
      ctx.drawImage(bitmap, -dw/2, -dh/2, dw, dh);

      ctx.restore();
    }

    // abre em nova aba
    const url = canvas.toDataURL("image/png");
    const win = window.open();
    if(win){
      win.document.write(`<title>Montagem ‚Ä¢ Faz de Conta</title><img src="${url}" style="max-width:100%;height:auto;display:block;margin:0 auto;background:#111"/>`);
    }else{
      alert("Seu navegador bloqueou pop-up. Permita pop-up e tente novamente.");
    }
  });

  function loadImage(src){
    return new Promise((resolve,reject)=>{
      const im = new Image();
      im.crossOrigin = "anonymous";
      im.onload = ()=> resolve(im);
      im.onerror = reject;
      im.src = src;
    });
  }

  // ===================== VERS√çCULO DO DIA =====================
  const VERSES = [
    { ref:"Romanos 12:12", text:"Alegrai-vos na esperan√ßa, sede pacientes na tribula√ß√£o, perseverai na ora√ß√£o." },
    { ref:"Salmos 23:1", text:"O Senhor √© o meu pastor; nada me faltar√°." },
    { ref:"Prov√©rbios 3:5", text:"Confia no Senhor de todo o teu cora√ß√£o e n√£o te estribes no teu pr√≥prio entendimento." },
    { ref:"Isa√≠as 41:10", text:"N√£o temas, porque eu sou contigo; n√£o te assombres, porque eu sou o teu Deus." },
    { ref:"Filipenses 4:13", text:"Tudo posso naquele que me fortalece." },
    { ref:"Salmos 46:1", text:"Deus √© o nosso ref√∫gio e fortaleza, socorro bem presente na ang√∫stia." },
    { ref:"Mateus 11:28", text:"Vinde a mim, todos os que estais cansados e oprimidos, e eu vos aliviarei." },
    { ref:"Jo√£o 14:27", text:"Deixo-vos a paz, a minha paz vos dou; n√£o vo-la dou como o mundo a d√°." }
  ];
  function dayOfYear(d){
    const start = new Date(d.getFullYear(), 0, 0);
    const diff = d - start;
    return Math.floor(diff / 86400000);
  }
  function setVerseOfDay(){
    const d = new Date();
    const idx = dayOfYear(d) % VERSES.length;
    const v = VERSES[idx];
    el("verseText").textContent = `"${v.text}"`;
    el("verseRef").textContent = v.ref;
  }
  setVerseOfDay();

  // ===================== TINT (hex -> hue) =====================
  function hexToHue(hex){
    // converte cor para matiz aproximado (0..360)
    if(!hex || hex[0] !== "#") return 0;
    const r = parseInt(hex.slice(1,3),16)/255;
    const g = parseInt(hex.slice(3,5),16)/255;
    const b = parseInt(hex.slice(5,7),16)/255;

    const max = Math.max(r,g,b);
    const min = Math.min(r,g,b);
    const d = max - min;
    if(d === 0) return 0;

    let h = 0;
    if(max === r) h = ((g-b)/d) % 6;
    else if(max === g) h = (b-r)/d + 2;
    else h = (r-g)/d + 4;

    h = Math.round(h * 60);
    if(h < 0) h += 360;
    return h;
  }

  // ===================== INIT UI =====================
  updateLayerInfo();
  updateControls();
</script>
</body>
</html>
