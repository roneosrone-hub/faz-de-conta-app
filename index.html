<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Faz de Conta Decora√ß√µes ‚Ä¢ Cat√°logo</title>

  <style>
    :root{
      --bg0:#070916;
      --bg1:#0b1230;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --muted2: rgba(255,255,255,.45);
      --shadow: 0 18px 50px rgba(0,0,0,.55);
      --radius: 22px;
      --radius2: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans";
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 15%, rgba(122, 66, 255,.25), transparent 60%),
        radial-gradient(900px 600px at 80% 30%, rgba(0, 255, 213,.14), transparent 55%),
        radial-gradient(900px 600px at 40% 90%, rgba(255, 64, 208,.12), transparent 50%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    .spark{
      position:fixed; inset:0; pointer-events:none; opacity:.55;
      background:
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.25), transparent 60%),
        radial-gradient(2px 2px at 35% 55%, rgba(255,255,255,.18), transparent 60%),
        radial-gradient(1px 1px at 70% 20%, rgba(255,255,255,.20), transparent 60%),
        radial-gradient(2px 2px at 85% 70%, rgba(255,255,255,.16), transparent 60%);
      filter: blur(.2px);
      mix-blend-mode: screen;
    }

    .wrap{
      width:min(1200px, 92vw);
      margin: 18px auto 48px;
    }

    /* slogan fixo */
    .floatingSlogan{
      position: sticky;
      top: 10px;
      z-index: 10;
      width: fit-content;
      margin-bottom: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:8px;
    }

    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }

    /* header topo */
    .header{
      padding: 16px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }
    .header::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(700px 200px at 20% 10%, rgba(255,255,255,.10), transparent 55%),
                  radial-gradient(600px 240px at 80% 0%, rgba(0,255,213,.12), transparent 55%);
      opacity:.65;
      pointer-events:none;
    }

    .headGrid{
      position:relative;
      z-index:1;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      align-items:stretch;
    }
    @media(max-width: 980px){
      .headGrid{ grid-template-columns: 1fr; }
    }

    /* bloco marca */
    .brandBlock{
      display:flex;
      gap:14px;
      align-items:center;
      min-height: 140px;
    }
    .logoBox{
      width:140px; height:140px;
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      box-shadow: 0 14px 35px rgba(0,0,0,.35);
      flex:0 0 auto;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
      color: rgba(255,255,255,.85);
    }
    .logoBox img{ width:100%; height:100%; object-fit:cover; display:block; }
    .logoFallback{ display:none; }

    .brandText{ flex:1; min-width: 220px; }
    .gradTitle{
      font-weight: 1000;
      font-size: 40px;
      line-height: 1.05;
      letter-spacing: .6px;
      text-transform: uppercase;

      background: linear-gradient(90deg,#ff4bd8 0%,#7a42ff 18%,#00c7ff 34%,#00ffd5 50%,#7dff6a 66%,#ffd94a 82%,#ff4bd8 100%);
      background-size: 260% 100%;
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
      animation: gradMove 6.5s linear infinite;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,.55));
    }
    @keyframes gradMove{ 0%{background-position:0% 50%;} 100%{background-position:260% 50%;} }

    .sloganBelow{
      margin-top: 6px;
      font-size: 17px; /* maior */
      font-weight: 900;
      color: rgba(255,255,255,.92);
      text-shadow: 0 10px 26px rgba(0,0,0,.45);
      display:flex;
      align-items:center;
      gap:8px;
      opacity:.98;
    }

    .actions{
      margin-top: 10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      border:none;
      cursor:pointer;
      color: rgba(255,255,255,.92);
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 800;
      font-size: 13px;
      box-shadow: 0 14px 35px rgba(0,0,0,.28);
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.11); border-color: rgba(255,255,255,.18); }
    .btn.primary{
      background: linear-gradient(90deg, rgba(255,75,216,.38), rgba(0,255,213,.26), rgba(255,217,74,.24));
      border-color: rgba(255,255,255,.18);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 28px;
      height: 22px;
      padding: 0 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.14);
      font-weight: 1000;
      font-size: 12px;
      margin-left: 6px;
    }

    /* painel "Monte seu pedido" no lugar do Jaciara/Whats/data */
    .panel{
      padding: 14px;
      border-radius: var(--radius);
    }
    .panel h2{
      margin: 2px 0 6px;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .panel p{
      margin: 0 0 10px;
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
    }

    .field{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      margin-bottom: 10px;
    }
    .field input, .field select{
      width:100%;
      border:none;
      outline:none;
      background: transparent;
      color: rgba(255,255,255,.9);
      font-size: 13px;
    }
    .field input::placeholder{ color: rgba(255,255,255,.35); }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top: 6px;
    }
    .toggle{
      display:flex;
      align-items:center;
      gap:10px;
      color: rgba(255,255,255,.75);
      font-size: 13px;
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 10px 12px;
      user-select:none;
    }
    .switch{
      width: 44px; height: 26px;
      border-radius: 999px;
      background: rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.14);
      position:relative;
      cursor:pointer;
      flex:0 0 auto;
    }
    .knob{
      width: 22px; height: 22px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      position:absolute;
      top:1px; left:1px;
      transition: left .18s ease, background .18s ease;
    }
    .switch.on{ background: rgba(0,255,213,.24); }
    .switch.on .knob{ left: 21px; background: rgba(255,255,255,.96); }

    /* montagem */
    .montagemCard{ margin-top: 14px; padding: 12px; }
    .montagemHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .montagemHead .hint{
      color: rgba(255,255,255,.65);
      font-size: 12px;
    }
    .stageWrap{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      overflow:hidden;
      position:relative;
      height: 420px;
    }
    @media(max-width: 980px){ .stageWrap{ height: 360px; } }
    @media(max-width: 560px){ .stageWrap{ height: 320px; } }

    /* fundo bonito no stage */
    .stageBg{
      position:absolute; inset:0;
      background:
        radial-gradient(900px 500px at 30% 20%, rgba(122,66,255,.18), transparent 60%),
        radial-gradient(700px 420px at 80% 60%, rgba(0,255,213,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      pointer-events:none;
    }

    .stage{
      position:absolute; inset:0;
      touch-action:none;
    }

    .layer{
      position:absolute;
      left: 50%; top: 50%;
      transform: translate(-50%,-50%);
      user-select:none;
      cursor: grab;
      will-change: transform, opacity;
    }
    .layer:active{ cursor: grabbing; }

    .layer img{
      display:block;
      width: 240px;
      height: auto;
      filter: drop-shadow(0 18px 30px rgba(0,0,0,.45));
      pointer-events:none;
    }

    .layer.selected{
      outline: 2px dashed rgba(0,255,213,.55);
      outline-offset: 6px;
      border-radius: 12px;
    }

    /* controles */
    .controls{
      margin-top: 10px;
      padding: 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
    }
    .controls .line{
      color: rgba(255,255,255,.70);
      font-size: 13px;
      margin-bottom: 10px;
      line-height:1.35;
    }
    .controls b{ color: rgba(255,255,255,.92); }

    .sliderRow{
      display:grid;
      grid-template-columns: 170px 1fr 70px;
      gap: 10px;
      align-items:center;
      margin: 10px 0;
    }
    @media(max-width: 560px){ .sliderRow{ grid-template-columns: 130px 1fr 60px; } }
    input[type="range"]{ width:100%; }

    .btnRow{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    @media(max-width: 560px){ .btnRow{ grid-template-columns: 1fr; } }

    /* cat√°logo */
    .sectionTitle{
      margin: 18px 0 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .sectionTitle h3{ margin:0; font-size: 16px; letter-spacing:.2px; }
    .badge{
      font-size: 12px;
      color: rgba(255,255,255,.65);
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    @media(max-width: 980px){ .grid{ grid-template-columns: repeat(2, 1fr);} }
    @media(max-width: 560px){ .grid{ grid-template-columns: 1fr;} }

    .item{ padding: 12px; cursor:pointer; }
    .thumb{
      height: 150px;
      border-radius: 18px;
      overflow:hidden;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .thumb img{
      width:100%; height:100%;
      object-fit: cover;
      display:block;
      transform: scale(1.02);
      transition: transform .25s ease;
    }
    .item:hover .thumb img{ transform: scale(1.06); }
    .itemName{ margin: 10px 0 6px; font-weight: 1000; letter-spacing:.2px; }
    .itemDesc{
      margin:0;
      color: rgba(255,255,255,.65);
      font-size: 12px;
      line-height:1.35;
      min-height: 32px;
    }
    .itemFooter{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
    }
    .price{ font-weight: 1000; font-size: 13px; color: rgba(255,255,255,.88); }
    .tag{
      font-size: 12px;
      color: rgba(255,255,255,.65);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
    }

    .footer{
      margin-top: 18px;
      text-align:center;
      color: rgba(255,255,255,.45);
      font-size: 12px;
    }
  </style>
</head>

<body>
  <div class="spark"></div>

  <div class="wrap">
    <div class="floatingSlogan">
      <span>‚ú®</span>
      <span>Onde a imagina√ß√£o vira festa</span>
    </div>

    <!-- HEADER -->
    <div class="header card">
      <div class="headGrid">
        <!-- Marca + bot√µes -->
        <div class="brandBlock">
          <div class="logoBox" id="logoBox">
            <img id="logoImg" src="/assets/logo.png" alt="Faz de Conta Decora√ß√µes"/>
            <div class="logoFallback" id="logoFallback">FC</div>
          </div>

          <div class="brandText">
            <div class="gradTitle">FAZ DE CONTA DECORA√á√ïES</div>
            <div class="sloganBelow">‚ú® Onde a imagina√ß√£o vira festa</div>

            <div class="actions">
              <button class="btn" id="btnWhats">üí¨ WhatsApp</button>
              <button class="btn" id="btnCart">üõí Carrinho <span class="pill" id="cartCount">0</span></button>
              <button class="btn" id="btnClearStage">üßº Limpar montagem</button>
              <button class="btn primary" id="btnFinish">‚úÖ Finalizar (Pix)</button>
            </div>
          </div>
        </div>

        <!-- Monte seu pedido (ficou no lugar da barra com Jaciara/Whats/data) -->
        <div class="panel card">
          <h2>Monte seu pedido</h2>
          <p>Pesquise e clique nos itens para eles aparecerem na montagem. Depois arraste e ajuste.</p>

          <div class="field">
            üîé <input id="q" placeholder="Pesquisar (ex: arco, cortina, tapete...)"/>
          </div>

          <div class="field">
            üß©
            <select id="cat">
              <option value="Todas">Todas as categorias</option>
            </select>
          </div>

          <div class="row">
            <div class="toggle">
              üîí Mostrar pre√ßos
              <div class="switch" id="priceSwitch"><div class="knob"></div></div>
            </div>
            <button class="btn" id="btnClear">üßº Limpar filtros</button>
          </div>
        </div>
      </div>
    </div>

    <!-- MONTAGEM -->
    <div class="card montagemCard">
      <div class="montagemHead">
        <div style="font-weight:1000;">üß© Montagem do cliente</div>
        <div class="hint">Clique num item do cat√°logo ‚Üí ele entra aqui. Arraste com dedo/mouse.</div>
      </div>

      <div class="stageWrap" id="stageWrap">
        <div class="stageBg"></div>
        <div class="stage" id="stage"></div>
      </div>

      <div class="controls">
        <div class="line"><b>Item selecionado:</b> <span id="selName">Nenhum</span></div>

        <div class="sliderRow">
          <div>Escala:</div>
          <input type="range" id="scale" min="20" max="200" value="100"/>
          <div><span id="scaleVal">100</span>%</div>
        </div>

        <div class="sliderRow">
          <div>Rota√ß√£o:</div>
          <input type="range" id="rot" min="-180" max="180" value="0"/>
          <div><span id="rotVal">0</span>¬∞</div>
        </div>

        <div class="sliderRow">
          <div>Opacidade:</div>
          <input type="range" id="opa" min="10" max="100" value="100"/>
          <div><span id="opaVal">100</span>%</div>
        </div>

        <div class="btnRow">
          <button class="btn" id="btnFront">‚¨ÜÔ∏è Frente</button>
          <button class="btn" id="btnBack">‚¨áÔ∏è Fundo</button>
          <button class="btn" id="btnDuplicate">üìå Duplicar</button>
          <button class="btn primary" id="btnDelete">üóëÔ∏è Apagar</button>
        </div>

        <div class="controls" style="margin-top:12px;">
          <div class="line" style="margin:0; font-size:12px; opacity:.85;">
            üí° Dica: para o arco/bal√µes ficar ‚Äúmenos forte‚Äù em cima do cen√°rio, diminua a <b>opacidade</b>.
          </div>
        </div>
      </div>
    </div>

    <!-- ITENS -->
    <div class="sectionTitle">
      <h3>‚ú® Itens do cat√°logo (clique para jogar na montagem)</h3>
      <div class="badge"><span id="itemsCount">0</span> itens</div>
    </div>

    <div class="grid" id="grid"></div>

    <div class="footer">¬© Faz de Conta Decora√ß√µes ‚Ä¢ Cat√°logo</div>
  </div>

<script>
  // ========= CONFIG =========
  const CONFIG = {
    whatsappNumber: "5566996223481",
    whatsappDisplay: "(66) 99622-3481",
  };

  // ========= ITENS =========
  // IMPORTANTE: coloque as imagens dentro de /assets/
  // Exemplo de nomes abaixo. Troque pelos seus arquivos reais.
  const ITENS = [
    {
      id:"baloes",
      nome:"Bal√µes (Arco Org√¢nico)",
      cat:"Bal√µes",
      desc:"Bal√µes realistas para montagem. Arraste e ajuste.",
      preco: 450,
      thumb: "/assets/thumb-baloes.jpg",
      img: "/assets/baloes.png"
    },
    {
      id:"cortina_led",
      nome:"Cortina de LED",
      cat:"Ilumina√ß√£o",
      desc:"Cortina de LED para fundo e brilho.",
      preco: 120,
      thumb: "/assets/thumb-led.jpg",
      img: "/assets/led.png"
    },
    {
      id:"arco_estrutura",
      nome:"Arco (Estrutura)",
      cat:"Estruturas",
      desc:"Estrutura para decora√ß√£o (arco).",
      preco: 180,
      thumb: "/assets/thumb-arco.jpg",
      img: "/assets/arco.png"
    },
    {
      id:"tapete",
      nome:"Tapete para fotos",
      cat:"Cen√°rio",
      desc:"Tapete base para fotos/cen√°rio.",
      preco: 80,
      thumb: "/assets/thumb-tapete.jpg",
      img: "/assets/tapete.png"
    },
    {
      id:"painel",
      nome:"Painel (Estrutura)",
      cat:"Estruturas",
      desc:"Painel para fundo (retangular).",
      preco: 200,
      thumb: "/assets/thumb-painel.jpg",
      img: "/assets/painel.png"
    },
  ];

  // ========= UTIL =========
  const el = (id)=>document.getElementById(id);
  const money = (v)=> "R$ " + Number(v||0).toFixed(2).replace(".",",");

  // ========= LOGO fallback =========
  (function(){
    const img = el("logoImg");
    const fb = el("logoFallback");
    img.onerror = ()=>{
      img.style.display="none";
      fb.style.display="block";
    };
  })();

  // ========= Whats =========
  el("btnWhats").addEventListener("click", ()=>{
    const url = `https://wa.me/${CONFIG.whatsappNumber}?text=${encodeURIComponent("Ol√°! Quero informa√ß√µes sobre os itens do cat√°logo da Faz de Conta Decora√ß√µes.")}`;
    window.open(url, "_blank");
  });

  // ========= FILTROS / PRE√áOS =========
  let showPrices = false;
  const state = {
    q: "",
    cat: "Todas",
    cart: new Map(),
  };

  function setSwitch(on){
    const sw = el("priceSwitch");
    sw.classList.toggle("on", on);
    showPrices = on;
    renderCatalog();
  }
  el("priceSwitch").addEventListener("click", ()=> setSwitch(!showPrices));

  el("q").addEventListener("input",(e)=>{
    state.q = (e.target.value||"").toLowerCase().trim();
    renderCatalog();
  });
  el("cat").addEventListener("change",(e)=>{
    state.cat = e.target.value;
    renderCatalog();
  });
  el("btnClear").addEventListener("click", ()=>{
    state.q = "";
    state.cat = "Todas";
    el("q").value = "";
    el("cat").value = "Todas";
    renderCatalog();
  });

  // ========= categorias =========
  function buildCats(){
    const s = new Set(ITENS.map(i=>i.cat));
    const sel = el("cat");
    [...s].sort().forEach(c=>{
      const opt = document.createElement("option");
      opt.value = c; opt.textContent = c;
      sel.appendChild(opt);
    });
  }
  buildCats();

  function passFilter(item){
    const okCat = (state.cat === "Todas") || (item.cat === state.cat);
    const t = (item.nome + " " + item.desc + " " + item.cat).toLowerCase();
    const okQ = !state.q || t.includes(state.q);
    return okCat && okQ;
  }

  // ========= MONTAGEM (drag + transform) =========
  const stage = el("stage");
  let selected = null;

  // layers state
  let zCounter = 1;

  function selectLayer(node){
    [...stage.querySelectorAll(".layer")].forEach(n=>n.classList.remove("selected"));
    selected = node;
    if(selected){
      selected.classList.add("selected");
      el("selName").textContent = selected.dataset.name || "Item";
      // sync sliders
      el("scale").value = selected.dataset.scale || 100;
      el("rot").value = selected.dataset.rot || 0;
      el("opa").value = Math.round((parseFloat(selected.dataset.opa || "1"))*100);
      updateSliderLabels();
      applyTransform(selected);
    }else{
      el("selName").textContent = "Nenhum";
    }
  }

  function updateSliderLabels(){
    el("scaleVal").textContent = el("scale").value;
    el("rotVal").textContent = el("rot").value;
    el("opaVal").textContent = el("opa").value;
  }
  updateSliderLabels();

  function applyTransform(node){
    if(!node) return;
    const x = parseFloat(node.dataset.x || "0");
    const y = parseFloat(node.dataset.y || "0");
    const scale = parseFloat(node.dataset.scale || "100")/100;
    const rot = parseFloat(node.dataset.rot || "0");
    const opa = parseFloat(node.dataset.opa || "1");
    node.style.transform = `translate(${x}px, ${y}px) rotate(${rot}deg) scale(${scale})`;
    node.style.opacity = opa;
  }

  function createLayer(item){
    const layer = document.createElement("div");
    layer.className = "layer";
    layer.dataset.id = item.id;
    layer.dataset.name = item.nome;
    layer.dataset.x = "0";
    layer.dataset.y = "0";
    layer.dataset.scale = "100";
    layer.dataset.rot = "0";
    layer.dataset.opa = "1";
    layer.style.zIndex = String(++zCounter);

    const img = document.createElement("img");
    img.src = item.img;
    img.alt = item.nome;
    img.onerror = ()=>{
      // fallback simples se o arquivo n√£o existir
      img.style.width = "220px";
      img.style.height = "140px";
      img.style.objectFit = "cover";
      img.src = "/assets/placeholder.png";
    };
    layer.appendChild(img);

    // select on click
    layer.addEventListener("pointerdown", (e)=>{
      e.stopPropagation();
      selectLayer(layer);
    });

    // drag
    let dragging = false;
    let startX=0, startY=0, baseX=0, baseY=0;

    layer.addEventListener("pointerdown", (e)=>{
      e.preventDefault();
      dragging = true;
      layer.setPointerCapture(e.pointerId);
      startX = e.clientX;
      startY = e.clientY;
      baseX = parseFloat(layer.dataset.x || "0");
      baseY = parseFloat(layer.dataset.y || "0");
      layer.style.zIndex = String(++zCounter);
    });

    layer.addEventListener("pointermove", (e)=>{
      if(!dragging) return;
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;
      layer.dataset.x = String(baseX + dx);
      layer.dataset.y = String(baseY + dy);
      applyTransform(layer);
    });

    layer.addEventListener("pointerup", ()=>{
      dragging = false;
    });

    stage.appendChild(layer);
    selectLayer(layer);
    // adiciona carrinho (conta)
    const n = state.cart.get(item.id) || 0;
    state.cart.set(item.id, n+1);
    updateCartCount();
  }

  stage.addEventListener("pointerdown", ()=> selectLayer(null));

  // sliders -> layer
  function bindSlider(id, setter){
    el(id).addEventListener("input", ()=>{
      updateSliderLabels();
      if(!selected) return;
      setter(selected);
      applyTransform(selected);
    });
  }

  bindSlider("scale", (node)=> node.dataset.scale = el("scale").value );
  bindSlider("rot",   (node)=> node.dataset.rot   = el("rot").value );
  bindSlider("opa",   (node)=> node.dataset.opa   = String(parseInt(el("opa").value,10)/100) );

  // buttons
  el("btnFront").addEventListener("click", ()=>{
    if(!selected) return;
    selected.style.zIndex = String(++zCounter);
  });
  el("btnBack").addEventListener("click", ()=>{
    if(!selected) return;
    selected.style.zIndex = "1";
  });
  el("btnDuplicate").addEventListener("click", ()=>{
    if(!selected) return;
    const item = ITENS.find(i=>i.id===selected.dataset.id);
    if(!item) return;
    createLayer(item);
    if(selected){
      // desloca um pouco o novo pra n√£o ficar em cima
      selected.dataset.x = String(parseFloat(selected.dataset.x || "0") + 30);
      selected.dataset.y = String(parseFloat(selected.dataset.y || "0") + 20);
      applyTransform(selected);
    }
  });
  el("btnDelete").addEventListener("click", ()=>{
    if(!selected) return;
    const id = selected.dataset.id;
    selected.remove();
    selected = null;
    el("selName").textContent = "Nenhum";
    // reduz carrinho
    const n = state.cart.get(id) || 0;
    if(n<=1) state.cart.delete(id);
    else state.cart.set(id, n-1);
    updateCartCount();
  });

  function clearStage(){
    stage.innerHTML = "";
    selected = null;
    el("selName").textContent = "Nenhum";
    state.cart.clear();
    updateCartCount();
  }
  el("btnClearStage").addEventListener("click", clearStage);

  // ========= carrinho =========
  function updateCartCount(){
    el("cartCount").textContent = [...state.cart.values()].reduce((a,b)=>a+b,0);
  }
  updateCartCount();

  el("btnCart").addEventListener("click", ()=>{
    const totalItens = [...state.cart.values()].reduce((a,b)=>a+b,0);
    alert("Carrinho: " + totalItens + " item(ns) na montagem.");
  });

  el("btnFinish").addEventListener("click", ()=>{
    const totalItens = [...state.cart.values()].reduce((a,b)=>a+b,0);
    if(totalItens<=0){
      alert("Seu carrinho/montagem est√° vazio. Clique em um item do cat√°logo para adicionar.");
      return;
    }
    alert("Finalizar (Pix):\n(Pr√≥ximo passo: gerar Pix Copia e Cola.)");
  });

  // ========= cat√°logo render =========
  function renderCatalog(){
    const list = ITENS.filter(passFilter);
    el("itemsCount").textContent = list.length;

    const grid = el("grid");
    grid.innerHTML = "";

    list.forEach(item=>{
      const card = document.createElement("div");
      card.className = "card item";

      const thumb = document.createElement("div");
      thumb.className = "thumb";
      const img = document.createElement("img");
      img.src = item.thumb || item.img;
      img.alt = item.nome;
      img.onerror = ()=> img.src = "/assets/placeholder.png";
      thumb.appendChild(img);

      const name = document.createElement("div");
      name.className = "itemName";
      name.textContent = item.nome;

      const desc = document.createElement("p");
      desc.className = "itemDesc";
      desc.textContent = item.desc;

      const footer = document.createElement("div");
      footer.className = "itemFooter";

      const price = document.createElement("div");
      price.className = "price";
      price.textContent = showPrices ? money(item.preco) : "Pre√ßo: sob consulta";

      const tag = document.createElement("div");
      tag.className = "tag";
      tag.textContent = item.cat;

      footer.appendChild(tag);
      footer.appendChild(price);

      card.appendChild(thumb);
      card.appendChild(name);
      card.appendChild(desc);
      card.appendChild(footer);

      card.addEventListener("click", ()=> createLayer(item));
      grid.appendChild(card);
    });

    updateCartCount();
  }
  renderCatalog();
</script>

</body>
</html>
