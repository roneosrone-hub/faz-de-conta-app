<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Faz de Conta Decora√ß√µes ‚Ä¢ Cat√°logo + Montagem</title>

  <style>
    :root{
      --bg0:#070916;
      --bg1:#0b1230;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --muted2: rgba(255,255,255,.45);
      --shadow: 0 18px 50px rgba(0,0,0,.55);
      --radius: 22px;
      --radius2: 18px;
      --good: rgba(0,255,213,.25);
      --warn: rgba(255,217,74,.20);
      --bad: rgba(255,75,216,.18);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans";
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 15%, rgba(122, 66, 255,.25), transparent 60%),
        radial-gradient(900px 600px at 80% 30%, rgba(0, 255, 213,.14), transparent 55%),
        radial-gradient(900px 600px at 40% 90%, rgba(255, 64, 208,.12), transparent 50%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    .spark{
      position:fixed; inset:0; pointer-events:none; opacity:.55;
      background:
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.25), transparent 60%),
        radial-gradient(2px 2px at 35% 55%, rgba(255,255,255,.18), transparent 60%),
        radial-gradient(1px 1px at 70% 20%, rgba(255,255,255,.20), transparent 60%),
        radial-gradient(2px 2px at 85% 70%, rgba(255,255,255,.16), transparent 60%);
      filter: blur(.2px);
      mix-blend-mode: screen;
    }

    .wrap{
      width:min(1120px, 92vw);
      margin: 18px auto 48px;
    }

    .floatingSlogan{
      position: sticky;
      top: 10px;
      z-index: 10;
      width: fit-content;
      margin-bottom: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:8px;
    }

    .header{
      display:flex;
      flex-direction:column;
      gap:14px;
      padding: 18px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }
    .header::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(700px 200px at 20% 10%, rgba(255,255,255,.10), transparent 55%),
                  radial-gradient(600px 240px at 80% 0%, rgba(0,255,213,.12), transparent 55%);
      opacity:.65;
      pointer-events:none;
    }

    .headTop{
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
      position:relative;
      z-index:1;
    }

    .brandLeft{
      display:flex;
      gap:14px;
      align-items:center;
      flex: 1;
      min-width: 260px;
    }

    .logoBox{
      width: 96px; height: 86px;
      border-radius: 18px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      box-shadow: 0 14px 35px rgba(0,0,0,.35);
      flex:0 0 auto;
      display:flex; align-items:center; justify-content:center;
      position:relative;
    }
    .logoBox img{ width:100%; height:100%; object-fit:cover; display:block; }
    .logoBox .fallback{
      font-weight: 1000;
      letter-spacing:.8px;
      color: rgba(255,255,255,.85);
      background: linear-gradient(135deg, rgba(255,75,216,.25), rgba(0,255,213,.18));
      width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
    }

    .brandText{ min-width: 210px; }

    .gradTitle{
      font-weight: 1000;
      font-size: 40px;
      line-height: 1.05;
      letter-spacing: .6px;
      text-transform: uppercase;
      background: linear-gradient(
        90deg,
        #ff4bd8 0%,
        #7a42ff 18%,
        #00c7ff 34%,
        #00ffd5 50%,
        #7dff6a 66%,
        #ffd94a 82%,
        #ff4bd8 100%
      );
      background-size: 260% 100%;
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
      animation: gradMove 6.5s linear infinite;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,.55));
    }
    @keyframes gradMove{
      0%{ background-position:0% 50%; }
      100%{ background-position:260% 50%; }
    }

    .sloganBelow{
      margin-top: 6px;
      font-size: 16px; /* <<< aqui aumenta o ‚ÄúOnde a imagina√ß√£o vira festa‚Äù */
      font-weight: 900;
      color: rgba(255,255,255,.92);
      letter-spacing:.2px;
      text-shadow: 0 10px 26px rgba(0,0,0,.45);
    }

    /* METAS √Ä DIREITA (DE CIMA PRA BAIXO) */
    .metaCol{
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:flex-end;
      min-width: 220px;
      position:relative;
      z-index:1;
    }
    .chip{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.78);
      font-size: 12px;
      white-space:nowrap;
      box-shadow: 0 10px 26px rgba(0,0,0,.25);
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-start;
      position:relative;
      z-index:1;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      border:none;
      cursor:pointer;
      color: rgba(255,255,255,.92);
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 800;
      font-size: 13px;
      box-shadow: 0 14px 35px rgba(0,0,0,.28);
      transform: translateZ(0);
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.11); border-color: rgba(255,255,255,.18); }
    .btn:active{ transform: translateY(0px) scale(.99); }
    .btn.primary{
      background: linear-gradient(90deg, rgba(255,75,216,.38), rgba(0,255,213,.26), rgba(255,217,74,.24));
      border-color: rgba(255,255,255,.18);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 28px;
      height: 22px;
      padding: 0 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.14);
      font-weight: 1000;
      font-size: 12px;
      margin-left: 6px;
    }

    /* LAYOUT PRINCIPAL */
    .hero{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1.45fr .95fr;
      gap: 14px;
      align-items:stretch;
    }
    @media(max-width: 980px){ .hero{ grid-template-columns: 1fr; } }

    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }

    /* MONTAGEM (NO LUGAR DO VIDEO) */
    .stageHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
    }
    .stageHead .title{
      font-weight: 1000;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .hint{
      color: rgba(255,255,255,.60);
      font-size: 12px;
      text-align:right;
    }

    .stageWrap{
      padding: 12px;
    }

    .stage{
      position:relative;
      height: 420px;
      border-radius: 18px;
      background:
        radial-gradient(800px 320px at 30% 15%, rgba(122,66,255,.18), transparent 60%),
        radial-gradient(700px 280px at 80% 30%, rgba(0,255,213,.10), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.10));
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
      touch-action:none;
    }
    @media(max-width: 980px){ .stage{ height: 360px; } }

    .stage::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(2px 2px at 18% 28%, rgba(255,255,255,.12), transparent 60%),
        radial-gradient(2px 2px at 72% 22%, rgba(255,255,255,.08), transparent 60%),
        radial-gradient(2px 2px at 85% 70%, rgba(255,255,255,.07), transparent 60%);
      pointer-events:none;
      mix-blend-mode: screen;
      opacity:.6;
    }

    .obj{
      position:absolute;
      left: 50%; top: 50%;
      transform: translate(-50%, -50%);
      user-select:none;
      cursor: grab;
      filter: drop-shadow(0 10px 24px rgba(0,0,0,.35));
    }
    .obj:active{ cursor: grabbing; }
    .obj.selected{
      outline: 2px solid rgba(0,255,213,.25);
      outline-offset: 6px;
      border-radius: 14px;
    }
    .obj img{
      display:block;
      max-width: 520px;
      max-height: 520px;
      width: 260px; /* tamanho inicial */
      height: auto;
      pointer-events:none;
    }

    /* Painel da direita */
    .panel{
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .panel h2{
      margin: 2px 0 0;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .panel p{
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
    }

    .field{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
    }
    .field input, .field select{
      width:100%;
      border:none;
      outline:none;
      background: transparent;
      color: rgba(255,255,255,.9);
      font-size: 13px;
    }
    .field input::placeholder{ color: rgba(255,255,255,.35); }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }

    .toggle{
      display:flex;
      align-items:center;
      gap:10px;
      color: rgba(255,255,255,.75);
      font-size: 13px;
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 10px 12px;
      user-select:none;
    }
    .switch{
      width: 44px; height: 26px;
      border-radius: 999px;
      background: rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.14);
      position:relative;
      cursor:pointer;
      flex:0 0 auto;
    }
    .knob{
      width: 22px; height: 22px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      position:absolute;
      top:1px; left:1px;
      transition: left .18s ease, background .18s ease;
    }
    .switch.on{ background: rgba(0,255,213,.24); }
    .switch.on .knob{ left: 21px; background: rgba(255,255,255,.96); }

    /* CONTROLES DA MONTAGEM */
    .controls{
      padding: 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .controls .cap{
      font-size: 12px;
      color: rgba(255,255,255,.65);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .slider{
      width:100%;
      accent-color: #00ffd5;
    }

    .btnRow{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:10px;
    }
    .btnRow .btn{ width:100%; }

    .note{
      font-size: 12px;
      color: rgba(255,255,255,.60);
      line-height:1.35;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
    }

    /* GRID ITENS */
    .sectionTitle{
      margin: 18px 0 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .sectionTitle h3{
      margin:0;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .badge{
      font-size: 12px;
      color: rgba(255,255,255,.65);
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    @media(max-width: 980px){ .grid{ grid-template-columns: repeat(2, 1fr);} }
    @media(max-width: 560px){ .grid{ grid-template-columns: 1fr;} }

    .item{ padding: 12px; cursor:pointer; }
    .thumb{
      height: 150px;
      border-radius: 18px;
      overflow:hidden;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .thumb img{
      width:100%; height:100%;
      object-fit: cover;
      display:block;
      transform: scale(1.02);
      transition: transform .25s ease;
    }
    .item:hover .thumb img{ transform: scale(1.06); }

    .itemName{ margin: 10px 0 6px; font-weight: 1000; letter-spacing:.2px; }
    .itemDesc{
      margin:0;
      color: rgba(255,255,255,.65);
      font-size: 12px;
      line-height:1.35;
      min-height: 32px;
    }
    .itemFooter{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
    }
    .price{ font-weight: 1000; font-size: 13px; color: rgba(255,255,255,.88); }
    .tag{
      font-size: 12px;
      color: rgba(255,255,255,.65);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
    }

    .footer{
      margin-top: 18px;
      text-align:center;
      color: rgba(255,255,255,.45);
      font-size: 12px;
    }

    @media(max-width: 560px){
      .gradTitle{ font-size: 30px; }
      .sloganBelow{ font-size: 15px; }
      .logoBox{ width:74px; height:66px; }
      .btnRow{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="spark"></div>

  <div class="wrap">
    <div class="floatingSlogan">
      <span class="star">‚ú®</span>
      <span>Onde a imagina√ß√£o vira festa</span>
    </div>

    <div class="header">
      <div class="headTop">
        <div class="brandLeft">
          <div class="logoBox" id="logoBox" title="Logo">
            <img id="logoImg" alt="Faz de Conta Decora√ß√µes" style="display:none;">
            <div class="fallback" id="logoFallback">FC</div>
          </div>

          <div class="brandText">
            <div class="gradTitle">FAZ DE CONTA DECORA√á√ïES</div>
            <div class="sloganBelow">‚ú® Onde a imagina√ß√£o vira festa</div>
          </div>
        </div>

        <div class="metaCol">
          <div class="chip">üìç <b id="cityChip">Jaciara/MT</b></div>
          <div class="chip">üí¨ <b>WhatsApp:</b> <span id="whatsChip">(66) 99622-3481</span></div>
          <div class="chip">üìÖ <span id="today">--/--/----</span> ‚Ä¢ ‚è∞ <b id="clock">--:--</b></div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btnWhats">üí¨ WhatsApp</button>
        <button class="btn" id="btnCart">üõí Carrinho <span class="pill" id="cartCount">0</span></button>
        <button class="btn" id="btnClearStage">üßº Limpar montagem</button>
        <button class="btn primary" id="btnFinish">‚úÖ Finalizar (Pix)</button>
      </div>
    </div>

    <div class="hero">
      <!-- MONTAGEM -->
      <div class="card">
        <div class="stageHead">
          <div class="title">üß© Montagem do cliente</div>
          <div class="hint">
            Clique em um item do cat√°logo ‚ûú ele aparece aqui.<br/>
            Depois arraste com o dedo/mouse.
          </div>
        </div>

        <div class="stageWrap">
          <div class="stage" id="stage"></div>

          <div class="controls" style="margin-top:12px;">
            <div class="cap">
              <span>Item selecionado:</span>
              <b id="selName">Nenhum</b>
            </div>

            <div class="cap"><span>Escala:</span> <span id="scaleTxt">100%</span></div>
            <input class="slider" id="scale" type="range" min="30" max="220" value="100"/>

            <div class="cap"><span>Rota√ß√£o:</span> <span id="rotTxt">0¬∞</span></div>
            <input class="slider" id="rot" type="range" min="-180" max="180" value="0"/>

            <div class="cap"><span>Opacidade:</span> <span id="opTxt">100%</span></div>
            <input class="slider" id="op" type="range" min="20" max="100" value="100"/>

            <div class="btnRow">
              <button class="btn" id="btnFront">‚¨ÜÔ∏è Frente</button>
              <button class="btn" id="btnBack">‚¨áÔ∏è Fundo</button>
              <button class="btn" id="btnDup">üìå Duplicar</button>
              <button class="btn" id="btnDel">üóëÔ∏è Apagar</button>
            </div>

            <div class="note">
              üé® <b>Cor (opcional):</b> funciona melhor em bal√µes/LED.<br/>
              (√â ajuste de cor por matiz/satura√ß√£o ‚Äî fica ‚Äúreal‚Äù sem virar desenho.)
            </div>

            <div class="cap"><span>Matiz (Hue):</span> <span id="hueTxt">0</span></div>
            <input class="slider" id="hue" type="range" min="0" max="360" value="0"/>

            <div class="cap"><span>Satura√ß√£o:</span> <span id="satTxt">100%</span></div>
            <input class="slider" id="sat" type="range" min="0" max="220" value="100"/>

            <div class="btnRow">
              <button class="btn" id="btnColorReset">üîÅ Reset cor</button>
              <button class="btn" id="btnCenter">üéØ Centralizar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- PAINEL / FILTROS -->
      <div class="card panel">
        <h2>Monte seu pedido</h2>
        <p>Pesquise e clique nos itens para eles aparecerem na montagem. Depois arraste e ajuste.</p>

        <div class="field">
          üîé <input id="q" placeholder="Pesquisar (ex: arco, bal√µes, cilindro, LED...)"/>
        </div>

        <div class="field">
          üß©
          <select id="cat">
            <option value="Todas">Todas as categorias</option>
          </select>
        </div>

        <div class="row">
          <div class="toggle">
            üîí Mostrar pre√ßos
            <div class="switch" id="priceSwitch"><div class="knob"></div></div>
          </div>
          <button class="btn" id="btnClear">üßº Limpar filtros</button>
        </div>

        <div class="note" id="statusBox" style="border-color: rgba(255,255,255,.14);">
          ‚úÖ Dica: se ‚Äúsumir tudo‚Äù no Vercel, quase sempre √© branch errada (main vs principal) ou nome do arquivo diferente.
        </div>
      </div>
    </div>

    <!-- ITENS -->
    <div class="sectionTitle">
      <h3>‚ú® Itens do cat√°logo (clique para jogar na montagem)</h3>
      <div class="badge"><span id="itemsCount">0</span> itens</div>
    </div>

    <div class="grid" id="grid"></div>

    <div class="footer">¬© Faz de Conta Decora√ß√µes ‚Ä¢ Cat√°logo + Montagem</div>
  </div>

<script>
/* =========================================================
   CONFIG (edite aqui)
========================================================= */
const CONFIG = {
  whatsappNumber: "5566996223481",  // s√≥ n√∫meros (55 + DDD + n√∫mero)
  whatsappDisplay: "(66) 99622-3481",
  cidade: "Jaciara/MT",
  logoCandidates: ["logo.png","logo.jpg","logo.jpeg","logo.webp"]
};

/* =========================================================
   ITENS DO CAT√ÅLOGO (use os nomes EXATOS dos seus arquivos)
   ‚úÖ Pelo seu print, voc√™ j√° tem: arco-baloes.jpg, arco-1.jpg, arco-2.jpg, cilindros-1.jpg etc.
========================================================= */
const ITENS = [
  {
    id:"baloes_arco",
    nome:"Bal√µes (Arco Org√¢nico)",
    cat:"Bal√µes",
    desc:"Bal√µes para montagem. Ajuste escala/rota√ß√£o/cor para simular o tema.",
    preco:450,
    // imagem principal usada na montagem
    sprite:["arco-baloes.png","arco-baloes.jpg","arco-1.jpg","arco-2.jpg","capa.jpg"],
    // miniatura do card
    thumb:["arco-baloes.jpg","arco-1.jpg","arco-2.jpg","capa.jpg"]
  },
  {
    id:"cilindros",
    nome:"Cilindros (Suporte)",
    cat:"Estruturas",
    desc:"Estruturas e suporte para decora√ß√£o.",
    preco:180,
    sprite:["cilindros-1.jpg","cilindros-2.jpg","cilindros-3.jpg","cilindros-4.jpg","cilindros.jpg","capa.jpg"],
    thumb:["cilindros-1.jpg","cilindros-2.jpg","cilindros-3.jpg","capa.jpg"]
  },
  {
    id:"arco_metal",
    nome:"Arco (Estrutura)",
    cat:"Estruturas",
    desc:"Arco met√°lico (estrutura). Combine com bal√µes/LED.",
    preco:180,
    sprite:["arco-quadrado.jpg","arco-estrutura.jpg","capa.jpg"],
    thumb:["arco-quadrado.jpg","capa.jpg"]
  },
  {
    id:"cortina_led",
    nome:"Cortina de LED",
    cat:"Ilumina√ß√£o",
    desc:"Cortina LED para fundo e brilho. Fica √≥tima com opacidade e satura√ß√£o.",
    preco:120,
    sprite:["cortina-led.png","cortina-led.jpg","cortina-1.jpg","cortina-2.jpg","capa.jpg"],
    thumb:["cortina-led.jpg","cortina-1.jpg","cortina-2.jpg","capa.jpg"]
  },
  {
    id:"tapete",
    nome:"Tapete para fotos",
    cat:"Cen√°rio",
    desc:"Base para fotos e cen√°rio. Ajuste escala para ‚Äúencher‚Äù o ch√£o.",
    preco:80,
    sprite:["tapete.png","tapete.jpg","tapete-1.jpg","tapete-2.jpg","capa.jpg"],
    thumb:["tapete.jpg","tapete-1.jpg","tapete-2.jpg","capa.jpg"]
  }
];

/* =========================================================
   UTIL
========================================================= */
const el = (id)=>document.getElementById(id);
const money = (v)=> "R$ " + Number(v||0).toFixed(2).replace(".",",");

// tenta carregar uma lista de arquivos: usa o primeiro que existir
function loadFirstExisting(candidates, onOk, onFail){
  if(!candidates || !candidates.length){ onFail?.(); return; }
  let i = 0;
  const img = new Image();

  const tryNext = ()=>{
    if(i >= candidates.length){ onFail?.(); return; }
    img.src = candidates[i++];
  };

  img.onload = ()=> onOk?.(img.src);
  img.onerror = tryNext;
  tryNext();
}

// cria URL relativa segura
function fileUrl(name){
  // garante que n√£o venha com espa√ßos estranhos
  return "./" + String(name).trim();
}

/* =========================================================
   DATA / REL√ìGIO
========================================================= */
el("cityChip").textContent = CONFIG.cidade;
el("whatsChip").textContent = CONFIG.whatsappDisplay;

function tick(){
  const d = new Date();
  const dd = String(d.getDate()).padStart(2,"0");
  const mm = String(d.getMonth()+1).padStart(2,"0");
  const yy = d.getFullYear();
  el("today").textContent = `${dd}/${mm}/${yy}`;
  el("clock").textContent = d.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
}
tick();
setInterval(tick, 1000);

/* =========================================================
   LOGO
========================================================= */
(function loadLogo(){
  const imgEl = el("logoImg");
  const fb = el("logoFallback");

  const candidates = CONFIG.logoCandidates.map(fileUrl);

  loadFirstExisting(
    candidates,
    (src)=>{
      imgEl.src = src;
      imgEl.style.display = "block";
      fb.style.display = "none";
    },
    ()=>{
      imgEl.style.display = "none";
      fb.style.display = "flex";
    }
  );
})();

/* =========================================================
   FILTROS / PRE√áOS
========================================================= */
let showPrices = false;
const state = {
  q: "",
  cat: "Todas",
  cart: new Map()
};

function setSwitch(on){
  const sw = el("priceSwitch");
  sw.classList.toggle("on", on);
  showPrices = on;
  renderGrid();
}
el("priceSwitch").addEventListener("click", ()=> setSwitch(!showPrices));

el("q").addEventListener("input",(e)=>{
  state.q = (e.target.value||"").toLowerCase().trim();
  renderGrid();
});
el("cat").addEventListener("change",(e)=>{
  state.cat = e.target.value;
  renderGrid();
});
el("btnClear").addEventListener("click", ()=>{
  state.q = "";
  state.cat = "Todas";
  el("q").value = "";
  el("cat").value = "Todas";
  renderGrid();
});

/* =========================================================
   CATEGORIAS
========================================================= */
(function buildCats(){
  const s = new Set(ITENS.map(i=>i.cat));
  const sel = el("cat");
  [...s].sort().forEach(c=>{
    const opt = document.createElement("option");
    opt.value = c; opt.textContent = c;
    sel.appendChild(opt);
  });
})();

function passFilter(item){
  const okCat = (state.cat === "Todas") || (item.cat === state.cat);
  const t = (item.nome + " " + item.desc + " " + item.cat).toLowerCase();
  const okQ = !state.q || t.includes(state.q);
  return okCat && okQ;
}

/* =========================================================
   RENDER GRID
========================================================= */
function renderGrid(){
  const list = ITENS.filter(passFilter);
  el("itemsCount").textContent = list.length;

  const grid = el("grid");
  grid.innerHTML = "";

  list.forEach(item=>{
    const card = document.createElement("div");
    card.className = "card item";

    const thumb = document.createElement("div");
    thumb.className = "thumb";

    const img = document.createElement("img");
    img.alt = item.nome;

    loadFirstExisting(
      (item.thumb || []).map(fileUrl),
      (src)=>{ img.src = src; },
      ()=>{ img.src = fileUrl("capa.jpg"); }
    );

    thumb.appendChild(img);

    const name = document.createElement("div");
    name.className = "itemName";
    name.textContent = item.nome;

    const desc = document.createElement("p");
    desc.className = "itemDesc";
    desc.textContent = item.desc;

    const footer = document.createElement("div");
    footer.className = "itemFooter";

    const price = document.createElement("div");
    price.className = "price";
    price.textContent = showPrices ? money(item.preco) : "Pre√ßo: sob consulta";

    const tag = document.createElement("div");
    tag.className = "tag";
    tag.textContent = item.cat;

    footer.appendChild(tag);
    footer.appendChild(price);

    card.appendChild(thumb);
    card.appendChild(name);
    card.appendChild(desc);
    card.appendChild(footer);

    // clique: adiciona na montagem + soma carrinho
    card.addEventListener("click", ()=> {
      addToStage(item);
      const n = state.cart.get(item.id) || 0;
      state.cart.set(item.id, n+1);
      el("cartCount").textContent = [...state.cart.values()].reduce((a,b)=>a+b,0);
    });

    grid.appendChild(card);
  });

  el("cartCount").textContent = [...state.cart.values()].reduce((a,b)=>a+b,0);
}
renderGrid();

/* =========================================================
   MONTAGEM (DRAG / ESCALA / ROTA√á√ÉO / OPACIDADE / COR)
========================================================= */
const stage = el("stage");
let selected = null;

const ui = {
  name: el("selName"),
  scale: el("scale"),
  rot: el("rot"),
  op: el("op"),
  hue: el("hue"),
  sat: el("sat"),
  scaleTxt: el("scaleTxt"),
  rotTxt: el("rotTxt"),
  opTxt: el("opTxt"),
  hueTxt: el("hueTxt"),
  satTxt: el("satTxt")
};

function setSelected(node){
  if(selected && selected.el){
    selected.el.classList.remove("selected");
  }
  selected = node;

  if(!selected){
    ui.name.textContent = "Nenhum";
    return;
  }

  selected.el.classList.add("selected");
  ui.name.textContent = selected.itemName;

  // popula sliders
  ui.scale.value = Math.round(selected.scale*100);
  ui.rot.value = Math.round(selected.rot);
  ui.op.value = Math.round(selected.opacity*100);
  ui.hue.value = Math.round(selected.hue);
  ui.sat.value = Math.round(selected.sat*100);

  syncTexts();
}

function syncTexts(){
  ui.scaleTxt.textContent = ui.scale.value + "%";
  ui.rotTxt.textContent = ui.rot.value + "¬∞";
  ui.opTxt.textContent = ui.op.value + "%";
  ui.hueTxt.textContent = ui.hue.value;
  ui.satTxt.textContent = ui.sat.value + "%";
}

function applyTransforms(node){
  if(!node) return;

  const x = node.x, y = node.y;
  const s = node.scale;
  const r = node.rot;
  const o = node.opacity;

  node.el.style.left = x + "px";
  node.el.style.top  = y + "px";
  node.el.style.transform = `translate(-50%, -50%) rotate(${r}deg) scale(${s})`;
  node.el.style.opacity = String(o);

  // cor via filter (mant√©m foto realista)
  const hue = node.hue;
  const sat = node.sat;
  node.img.style.filter = `hue-rotate(${hue}deg) saturate(${sat})`;

  // LED ganha ‚Äúbrilho‚Äù
  if(node.isLed){
    node.el.style.mixBlendMode = "screen";
    node.el.style.filter = "drop-shadow(0 12px 30px rgba(255,255,255,.18))";
  }else{
    node.el.style.mixBlendMode = "normal";
  }
}

function addToStage(item){
  // cria objeto
  const obj = document.createElement("div");
  obj.className = "obj";
  obj.tabIndex = 0;

  const img = document.createElement("img");
  img.alt = item.nome;

  obj.appendChild(img);
  stage.appendChild(obj);

  const node = {
    id: "obj_" + Math.random().toString(16).slice(2),
    el: obj,
    img,
    itemId: item.id,
    itemName: item.nome,
    x: stage.clientWidth/2,
    y: stage.clientHeight/2,
    scale: 1.0,
    rot: 0,
    opacity: 1.0,
    hue: 0,
    sat: 1.0,
    isLed: /led/i.test(item.nome)
  };

  // carrega sprite
  loadFirstExisting(
    (item.sprite || []).map(fileUrl),
    (src)=>{ img.src = src; },
    ()=>{ img.src = fileUrl("capa.jpg"); }
  );

  // selecionar ao clicar
  obj.addEventListener("pointerdown", (e)=>{
    e.stopPropagation();
    setSelected(node);
    bringToFront(node);
    startDrag(e, node);
  });

  // aplica
  applyTransforms(node);
  setSelected(node);
}

stage.addEventListener("pointerdown", ()=>{
  setSelected(null);
});

function bringToFront(node){
  if(!node) return;
  node.el.parentNode.appendChild(node.el);
}
function sendToBack(node){
  if(!node) return;
  node.el.parentNode.insertBefore(node.el, node.el.parentNode.firstChild);
}

/* DRAG */
let drag = null;

function startDrag(e, node){
  const rect = stage.getBoundingClientRect();
  const startX = e.clientX;
  const startY = e.clientY;

  drag = {
    node,
    startX, startY,
    origX: node.x,
    origY: node.y,
    rect
  };

  node.el.setPointerCapture(e.pointerId);
  node.el.addEventListener("pointermove", onDragMove);
  node.el.addEventListener("pointerup", onDragUp, { once:true });
  node.el.addEventListener("pointercancel", onDragUp, { once:true });
}

function onDragMove(e){
  if(!drag) return;
  const { node, startX, startY, origX, origY } = drag;

  const dx = e.clientX - startX;
  const dy = e.clientY - startY;

  node.x = origX + dx;
  node.y = origY + dy;

  // limita dentro do stage
  node.x = Math.max(0, Math.min(stage.clientWidth, node.x));
  node.y = Math.max(0, Math.min(stage.clientHeight, node.y));

  applyTransforms(node);
}

function onDragUp(e){
  if(!drag) return;
  const { node } = drag;
  node.el.removeEventListener("pointermove", onDragMove);
  drag = null;
}

/* SLIDERS */
function bindSlider(slider, fn){
  slider.addEventListener("input", ()=>{
    if(!selected) return;
    fn();
    syncTexts();
    applyTransforms(selected);
  });
}

bindSlider(ui.scale, ()=>{
  selected.scale = Number(ui.scale.value)/100;
});
bindSlider(ui.rot, ()=>{
  selected.rot = Number(ui.rot.value);
});
bindSlider(ui.op, ()=>{
  selected.opacity = Number(ui.op.value)/100;
});
bindSlider(ui.hue, ()=>{
  selected.hue = Number(ui.hue.value);
});
bindSlider(ui.sat, ()=>{
  selected.sat = Number(ui.sat.value)/100;
});

/* BOT√ïES */
el("btnFront").addEventListener("click", ()=>{
  if(!selected) return;
  bringToFront(selected);
});
el("btnBack").addEventListener("click", ()=>{
  if(!selected) return;
  sendToBack(selected);
});
el("btnDup").addEventListener("click", ()=>{
  if(!selected) return;
  // duplica no DOM
  const item = ITENS.find(i=>i.id===selected.itemId);
  if(!item) return;
  addToStage(item);
  // copia ajustes
  if(selected){
    // o √∫ltimo criado virou selected (no addToStage)
    selected.scale = (Number(ui.scale.value)/100);
    selected.rot = Number(ui.rot.value);
    selected.opacity = Number(ui.op.value)/100;
    selected.hue = Number(ui.hue.value);
    selected.sat = Number(ui.sat.value)/100;
    // desloca um pouco
    selected.x += 24;
    selected.y += 18;
    applyTransforms(selected);
  }
});
el("btnDel").addEventListener("click", ()=>{
  if(!selected) return;
  selected.el.remove();
  setSelected(null);
});

el("btnColorReset").addEventListener("click", ()=>{
  if(!selected) return;
  selected.hue = 0;
  selected.sat = 1;
  ui.hue.value = 0;
  ui.sat.value = 100;
  syncTexts();
  applyTransforms(selected);
});

el("btnCenter").addEventListener("click", ()=>{
  if(!selected) return;
  selected.x = stage.clientWidth/2;
  selected.y = stage.clientHeight/2;
  applyTransforms(selected);
});

el("btnClearStage").addEventListener("click", ()=>{
  stage.innerHTML = "";
  setSelected(null);
});

/* =========================================================
   A√á√ïES (WHATS / CARRINHO / FINALIZAR)
========================================================= */
el("btnWhats").addEventListener("click", ()=>{
  const url = `https://wa.me/${CONFIG.whatsappNumber}?text=${encodeURIComponent("Ol√°! Quero informa√ß√µes sobre os itens do cat√°logo da Faz de Conta Decora√ß√µes.")}`;
  window.open(url, "_blank");
});

el("btnCart").addEventListener("click", ()=>{
  const totalItens = [...state.cart.values()].reduce((a,b)=>a+b,0);
  alert("Carrinho: " + totalItens + " item(ns).");
});

el("btnFinish").addEventListener("click", ()=>{
  const totalItens = [...state.cart.values()].reduce((a,b)=>a+b,0);
  if(totalItens<=0){
    alert("Seu carrinho est√° vazio. Clique em um item do cat√°logo para adicionar.");
    return;
  }
  alert("Finalizar (Pix):\nPr√≥ximo passo: gerar Pix Copia e Cola (integra√ß√£o).");
});

/* =========================================================
   STATUS (ajuda r√°pida quando imagens somem)
========================================================= */
(function quickChecks(){
  // Se capa.jpg n√£o existir, avisa (pra n√£o ficar tudo ‚Äúem branco‚Äù)
  const test = new Image();
  test.onload = ()=>{};
  test.onerror = ()=>{
    el("statusBox").innerHTML =
      "‚ö†Ô∏è <b>Aten√ß√£o:</b> n√£o encontrei <b>capa.jpg</b> na mesma pasta do index.html. " +
      "Coloque um arquivo <b>capa.jpg</b> na raiz para servir de fallback (quando alguma imagem falhar).";
    el("statusBox").style.borderColor = "rgba(255,217,74,.25)";
  };
  test.src = fileUrl("capa.jpg");
})();
</script>

<!--
===========================================================
‚úÖ COMO DEIXAR OS NOMES (REGRA SIMPLES)
===========================================================
1) Coloque as imagens na MESMA PASTA do index.html (raiz).
2) Use nomes SEM acento e tudo min√∫sculo, com h√≠fen:
   - arco-baloes.jpg
   - arco-1.jpg
   - cilindros-1.jpg
   - cortina-led.jpg
   - tapete.jpg
3) O nome no c√≥digo TEM que ser IGUALZINHO ao nome do arquivo.
   Ex: se no GitHub est√° "arco-baloes.jpg", no c√≥digo tem que estar "arco-baloes.jpg".

‚úÖ TESTE R√ÅPIDO (se a imagem aparece no deploy do Vercel):
Abra no navegador:
https://SEU-SITE.vercel.app/arco-baloes.jpg
Se der 404 -> Vercel n√£o publicou (branch errada ou arquivo n√£o foi commitado)

===========================================================
-->
</body>
</html>
